{"version":3,"sources":["../../../../www/js/app/engine_test.js"],"names":[],"mappings":"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","file":"engine_test.js","sourcesContent":["define(['app/vobjects/vobject', 'app/engine', 'app/vobjects/time',\n        'app/vobjects/recorder', 'app/vobjects/cycle', 'app/vobjects/dac',\n        'app/vobject_factory',\n        'lodash'],\n(vobject, engine, Time, Recorder, Cycle, DAC, VObjectFactory, _) => {\n  const printObject = (obj) => {\n    return JSON.stringify(obj, (k, v) => {\n      if (v === undefined) {\n        return '(undefined)';\n      }\n\n      return v;\n    });\n  };\n  beforeEach(() => {\n    jasmine.addMatchers({\n      toDeepEqual: (util, customEqualityTesters) => {\n        return {\n          compare: (actual, expected) => {\n            return {\n              pass: _.isEqual(actual, expected),\n              message: `Expected ${printObject(actual)} to equal ` +\n                `${printObject(expected)}`\n            };\n          }\n        };\n      }\n    });\n  });\n  const vobjectFactory = new VObjectFactory(0);\n  describe('VObjectGraph', () => {\n    describe('addVobject', () => {\n      it('should add an empty entry in .dedges', () => {\n        const graph = new engine.VObjectGraph();\n        const obj1 = vobjectFactory.create('log');\n        graph.addVobject(obj1);\n        expect(graph.dedges[obj1.id]).toEqual({});\n      });\n\n      it('should initially register the object as a leaf', () => {\n        const graph = new engine.VObjectGraph();\n        const obj = vobjectFactory.create('log');\n        graph.addVobject(obj);\n        expect(graph.leaves[obj.id]).toBe(obj);\n      });\n    });\n\n    describe('removeVobject', () => {\n      it('should remove the corresponding vobject from leaves', () => {\n        const graph = new engine.VObjectGraph();\n        const obj = vobjectFactory.create('log');\n        graph.addVobject(obj);\n        expect(graph.leaves[obj.id]).toBe(obj);\n        graph.removeVobject(obj);\n        expect(graph.leaves[obj.id]).toBe(undefined);\n      });\n\n      it('should remove any dedges coming from the vobject', () => {\n        const graph = new engine.VObjectGraph();\n        const obj1 = vobjectFactory.create('log');\n        const obj2 = vobjectFactory.create('log');\n        graph.addVobject(obj1);\n        graph.addVobject(obj2);\n        graph.addDedge(obj1, 3, obj2, 1);\n        graph.removeVobject(obj1);\n        expect(graph.dedges[obj1.id]).toBe(undefined);\n      });\n\n      it('should remove any dedges going to the vobject', () => {\n        const graph = new engine.VObjectGraph();\n        const obj1 = vobjectFactory.create('log');\n        const obj2 = vobjectFactory.create('log');\n        graph.addVobject(obj1);\n        graph.addVobject(obj2);\n        graph.addDedge(obj1, 3, obj2, 1);\n        expect(graph.dedges[obj1.id]).not.toEqual({});\n        graph.removeVobject(obj2);\n        expect(graph.dedges[obj1.id]).toEqual(undefined);\n      });\n    });\n\n    describe('addDedge', () => {\n      it('should register a new dedge', () => {\n        const graph = new engine.VObjectGraph();\n        const obj1 = vobjectFactory.create('log');\n        const obj2 = vobjectFactory.create('log');\n        graph.addVobject(obj1);\n        graph.addVobject(obj2);\n        graph.addDedge(obj1, 3, obj2, 1);\n        const edges = graph.dedges[obj1.id];\n        const fromEdge3 = edges[3];\n        const edge = fromEdge3[0];\n        expect(edge.from.id).toBe(obj1.id);\n        expect(edge.to.id).toBe(obj2.id);\n        expect(edge.fromOutput).toBe(3);\n        expect(edge.toInput).toBe(1);\n      });\n\n      it('should remove the from vobject from leaves', () => {\n        const graph = new engine.VObjectGraph();\n        const obj1 = vobjectFactory.create('log');\n        const obj2 = vobjectFactory.create('log');\n        graph.addVobject(obj1);\n        graph.addVobject(obj2);\n        expect(graph.leaves[obj1.id]).toBe(obj1);\n        graph.addDedge(obj1, 3, obj2, 1);\n        expect(graph.leaves[obj1.id]).toBe(undefined);\n      });\n    });\n  });\n\n  describe('removeDedge', () => {\n    it('should add the from vobject back to leaves if its the last output', () => {\n      const graph = new engine.VObjectGraph();\n      const obj1 = vobjectFactory.create('log');\n      const obj2 = vobjectFactory.create('log');\n      graph.addVobject(obj1);\n      graph.addVobject(obj2);\n      graph.addDedge(obj1, 3, obj2, 1);\n      expect(graph.leaves[obj2.id]).toBe(obj2);\n      expect(graph.leaves[obj1.id]).toBe(undefined);\n      graph.removeDedge(obj1, 3, obj2, 1);\n      expect(graph.leaves[obj1.id]).toBe(obj1);\n    });\n\n    it('should remove the dedge from this.dedges', () => {\n      const graph = new engine.VObjectGraph();\n      const obj1 = vobjectFactory.create('log');\n      const obj2 = vobjectFactory.create('log');\n      graph.addVobject(obj1);\n      graph.addVobject(obj2);\n      graph.addDedge(obj1, 3, obj2, 1);\n      expect(graph.dedges[obj1.id][3][0].to).toBe(obj2);\n      graph.removeDedge(obj1, 3, obj2, 1);\n      expect(graph.dedges[obj1.id][3]).toBe(undefined);\n    });\n  });\n\n  describe('AudioProcess', () => {\n    const createAudioProcess = () => {\n      const sampleTime = 0;\n      const sampleRate = 0;\n      const graph = new engine.VObjectGraph();\n      return new engine.AudioProcess(sampleTime, sampleRate, null, null,\n        graph, null);\n    };\n\n    it('should run a simple graph of two nodes, one source one sink', () => {\n      const ap = createAudioProcess();\n      const sampletime = new Time({ id: 0 });\n      // use a recorder to check the data comes through\n      const recorder = new Recorder({ id: 1 });\n      ap.graph.addVobject(sampletime);\n      ap.graph.addVobject(recorder);\n      ap.graph.addDedge(sampletime, 0, recorder, 0);\n      ap.run();\n      expect(recorder.record).toDeepEqual({ 0: { 0: '0' } });\n    });\n\n    it('should run a simple graph of two nodes, both leaves', () => {\n      const ap = createAudioProcess();\n      const recorder1 = new Recorder({ id: 0 });\n      const recorder2 = new Recorder({ id: 1 });\n      ap.graph.addVobject(recorder1);\n      ap.graph.addVobject(recorder2);\n      ap.run();\n      expect(recorder1.record).toDeepEqual({ 0: {} });\n      expect(recorder2.record).toDeepEqual({ 0: {} });\n    });\n\n    it('should run a graph of two nodes input to one', () => {\n      const ap = createAudioProcess();\n      const recorder = new Recorder({ id: 0 });\n      const sampletime1 = new Time({ id: 1 });\n      const sampletime2 = new Time({ id: 2 });\n      ap.graph.addVobject(recorder);\n      ap.graph.addVobject(sampletime1);\n      ap.graph.addVobject(sampletime2);\n      ap.graph.addDedge(sampletime1, 0, recorder, 0);\n      ap.graph.addDedge(sampletime2, 0, recorder, 1);\n      ap.run();\n      expect(recorder.record).toDeepEqual({ 0: { 0: '0', 1: '0' } });\n    });\n\n    it('should run a graph of two nodes input to one', () => {\n      const ap = createAudioProcess();\n      const recorder = new Recorder({ id: 0 });\n      const sampletime1 = new Time({ id: 1 });\n      const sampletime2 = new Time({ id: 2 });\n      ap.graph.addVobject(recorder);\n      ap.graph.addVobject(sampletime1);\n      ap.graph.addVobject(sampletime2);\n      ap.graph.addDedge(sampletime1, 0, recorder, 0);\n      ap.graph.addDedge(sampletime2, 0, recorder, 1);\n      ap.run();\n      expect(recorder.record).toDeepEqual({ 0: { 0: '0', 1: '0' } });\n    });\n\n    it('should run a graph where an output is connected to two inputs', () => {\n      const ap = createAudioProcess();\n      const recorder = new Recorder({ id: 0 });\n      const sampletime = new Time({ id: 1 });\n      ap.graph.addVobject(recorder);\n      ap.graph.addVobject(sampletime);\n      ap.graph.addDedge(sampletime, 0, recorder, 0);\n      ap.graph.addDedge(sampletime, 0, recorder, 1);\n      ap.run();\n      expect(recorder.record).toDeepEqual({ 0: { 0: '0', 1: '0' } });\n    });\n\n    it('should run a graph where an output is connected to two inputs', () => {\n      const ap = createAudioProcess();\n      const recorder = new Recorder({ id: 0 });\n      const sampletime = new Time({ id: 1 });\n      ap.graph.addVobject(recorder);\n      ap.graph.addVobject(sampletime);\n      ap.graph.addDedge(sampletime, 0, recorder, 0);\n      ap.graph.addDedge(sampletime, 0, recorder, 1);\n      ap.run();\n      expect(recorder.record).toDeepEqual({ 0: { 0: '0', 1: '0' } });\n    });\n  });\n\n  /* this is a neat integration test, but it causes an annoying beep :D\n  describe('Engine', function() {\n    it('should put data to the DAC', function() {\n      const theEngine = new engine.Engine();\n      const cycle = new Cycle();\n      const dac = new DAC();\n\n      theEngine.graph.addVobject(cycle);\n      theEngine.graph.addVobject(dac);\n\n      // stereo\n      theEngine.graph.addDedge(cycle, 0, dac, 0);\n      theEngine.graph.addDedge(cycle, 0, dac, 1);\n\n      theEngine.start();\n\n      window.setTimeout(function() {\n        theEngine.stop();\n      }, 1000);\n    });\n  }); */\n});\n"]}