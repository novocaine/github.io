{"version":3,"sources":["../../../../../www/js/app/vobjects/cycle.js"],"names":[],"mappings":"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","file":"cycle.js","sourcesContent":["define(['app/vobjects/vobject', 'app/util', 'lodash'],\n(vobject, util, _) => {\n  class Cycle extends vobject.VObject {\n    numInputs() { return 1; }\n    numOutputs() { return 1; }\n\n    constructor(options, frequency = 440) {\n      super(options, frequency);\n      this.frequency = frequency;\n      this._prevx = 0.0;\n      this._prevFrequency = 0.0;\n    }\n\n    generateXmodResult(result, context, frequency) {\n      let x = this._prevx;\n      for (let i = 0; i < result.length; i++) {\n        const radiansPerSample = (frequency[i] * 2 * Math.PI) / context.sampleRate;\n        x += radiansPerSample;\n        result[i] = Math.cos(x);\n      }\n      this._prevx = x;\n    }\n\n    generateFixedFreqResult(result, context, frequency, from, until) {\n      from = Math.min(Math.max(from, 0), result.length);\n      until = Math.min(Math.max(until, 0), result.length);\n\n      const radiansPerSample = (frequency * 2 * Math.PI) / context.sampleRate;\n      if (until === undefined) {\n        until = result.length;\n      }\n      for (let i = from; i < until; i++) {\n        this._prevx += radiansPerSample;\n        result[i] = Math.cos(this._prevx);\n      }\n    }\n\n    generateMsgResult(result, context, messages) {\n      this.generateFixedFreqResult(result, context, this._prevFrequency, 0,\n        messages.length === 0 ? result.length :\n          messages[0].sampleTime - context.sampleTime);\n\n      for (let i = 0; i < messages.length; i++) {\n        const msg = messages[i];\n        this.generateFixedFreqResult(result, context, msg.data,\n          msg.sampleTime - context.sampleTime,\n          i === messages.length - 1 ? result.length :\n            messages[i + 1].sampleTime - context.sampleTime);\n      }\n\n      if (messages.length) {\n        this._prevFrequency = messages[messages.length - 1].data;\n      }\n    }\n\n    generate(context, inputs, outputs) {\n      const frequency = 0 in inputs ? inputs[0] : this.frequency;\n      const result = context.getBuffer();\n\n      if (util.isAudioArray(frequency)) {\n        this.generateXmodResult(result, context, frequency);\n      } else if (_.isNumber(frequency)) {\n        this.generateFixedFreqResult(result, context, frequency, 0, result.length);\n      } else if (_.isArray(frequency)) {\n        this.generateMsgResult(result, context, frequency);\n      } else {\n        throw Error(`unexpected input type`);\n      }\n\n      return [result];\n    }\n  }\n\n  Cycle.vobjectClass = 'oscillator';\n  Cycle.vobjectSymbol = 'osc';\n\n  return Cycle;\n});\n"]}